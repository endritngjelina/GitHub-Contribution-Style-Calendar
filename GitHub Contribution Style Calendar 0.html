<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Style Habit Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
            color: #f0f6fc;
            min-height: 100vh;
            overflow-x: auto;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(22, 27, 34, 0.8);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #30363d;
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #58a6ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #8b949e;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            background: rgba(22, 27, 34, 0.6);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #30363d;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: 500;
            color: #f0f6fc;
            font-size: 0.9rem;
        }

        input, select, button {
            padding: 10px 12px;
            border: 1px solid #30363d;
            border-radius: 6px;
            background: #21262d;
            color: #f0f6fc;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #58a6ff;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        button {
            background: linear-gradient(135deg, #238636, #2ea043);
            border: none;
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        button:hover {
            background: linear-gradient(135deg, #2ea043, #238636);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(35, 134, 54, 0.3);
        }

        .secondary-btn {
            background: linear-gradient(135deg, #6e7681, #8b949e) !important;
        }

        .secondary-btn:hover {
            background: linear-gradient(135deg, #8b949e, #6e7681) !important;
        }

        .danger-btn {
            background: linear-gradient(135deg, #da3633, #f85149) !important;
        }

        .danger-btn:hover {
            background: linear-gradient(135deg, #f85149, #da3633) !important;
        }

        .calendar-container {
            background: rgba(22, 27, 34, 0.8);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #30363d;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stats {
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: #8b949e;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .calendar {
            overflow-x: auto;
            padding: 10px 0;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 10px;
            min-width: 800px;
        }

        .month-labels {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 2px;
            font-size: 12px;
            color: #8b949e;
            margin-bottom: 5px;
            grid-column: 2;
        }

        .weekday-labels {
            display: grid;
            grid-template-rows: repeat(7, 1fr);
            gap: 2px;
            font-size: 12px;
            color: #8b949e;
            text-align: right;
            padding-right: 10px;
            grid-row: 2;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(53, 1fr);
            grid-template-rows: repeat(7, 1fr);
            gap: 2px;
            grid-column: 2;
            grid-row: 2;
        }

        .day {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .day:hover {
            border: 1px solid #58a6ff;
            transform: scale(1.2);
        }

        .legend {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            font-size: 12px;
            color: #8b949e;
        }

        .legend-item {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .tooltip {
            position: absolute;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 12px;
            z-index: 1000;
            pointer-events: none;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
            display: none;
        }

        .habit-form {
            background: rgba(22, 27, 34, 0.8);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #30363d;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            align-items: end;
        }

        .themes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .theme-btn {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid transparent;
            background: rgba(33, 38, 45, 0.8);
            color: #8b949e;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
        }

        .theme-btn.active {
            border-color: #58a6ff;
            background: rgba(88, 166, 255, 0.1);
            color: #58a6ff;
        }

        .analytics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .analytics-card {
            background: rgba(22, 27, 34, 0.8);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #30363d;
            text-align: center;
        }

        .analytics-value {
            font-size: 2rem;
            font-weight: 600;
            color: #58a6ff;
            margin-bottom: 5px;
        }

        .analytics-label {
            color: #8b949e;
            font-size: 0.9rem;
        }

        .export-section {
            background: rgba(22, 27, 34, 0.8);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #30363d;
            margin-bottom: 20px;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .calendar-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .stats {
                flex-wrap: wrap;
            }
        }

        .streak-indicator {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 6px;
            height: 6px;
            background: #ffd33d;
            border-radius: 50%;
            display: none;
        }

        .day.streak .streak-indicator {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #21262d;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #238636, #2ea043);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>GitHub Style Habit Tracker</h1>
            <p class="subtitle">Track your daily habits and visualize your consistency with beautiful contribution graphs</p>
            <div class="progress-bar">
                <div class="progress-fill" id="yearProgress"></div>
            </div>
        </header>

        <div class="habit-form">
            <h3 style="margin-bottom: 15px; color: #f0f6fc;">Quick Actions</h3>
            <div class="form-row">
                <div class="control-group">
                    <label for="habitSelect">Select Habit</label>
                    <select id="habitSelect">
                        <option value="exercise">Exercise</option>
                        <option value="reading">Reading</option>
                        <option value="meditation">Meditation</option>
                        <option value="coding">Coding</option>
                        <option value="water">Drink Water</option>
                        <option value="sleep">Good Sleep</option>
                        <option value="custom">Custom Habit</option>
                    </select>
                </div>
                <button onclick="logToday()">Log Today</button>
            </div>
            <input type="text" id="customHabit" placeholder="Enter custom habit name" style="margin-top: 10px; display: none;">
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="dateInput">Select Date</label>
                <input type="date" id="dateInput">
            </div>
            
            <div class="control-group">
                <label for="valueInput">Value (0-10)</label>
                <input type="number" id="valueInput" min="0" max="10" value="1">
            </div>
            
            <div class="control-group">
                <label for="habitInput">Habit Name</label>
                <input type="text" id="habitInput" placeholder="e.g., Exercise, Reading">
            </div>
            
            <div class="control-group">
                <label>&nbsp;</label>
                <button onclick="logHabit()">Log Habit</button>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Color Themes</label>
                <div class="themes">
                    <div class="theme-btn active" onclick="setTheme('github')" data-theme="github">GitHub</div>
                    <div class="theme-btn" onclick="setTheme('ocean')" data-theme="ocean">Ocean</div>
                    <div class="theme-btn" onclick="setTheme('forest')" data-theme="forest">Forest</div>
                    <div class="theme-btn" onclick="setTheme('sunset')" data-theme="sunset">Sunset</div>
                    <div class="theme-btn" onclick="setTheme('purple')" data-theme="purple">Purple</div>
                    <div class="theme-btn" onclick="setTheme('fire')" data-theme="fire">Fire</div>
                </div>
            </div>
            
            <div class="control-group">
                <label>&nbsp;</label>
                <button class="danger-btn" onclick="clearAllData()">Clear All Data</button>
            </div>
        </div>

        <div class="analytics">
            <div class="analytics-card">
                <div class="analytics-value" id="totalDays">0</div>
                <div class="analytics-label">Total Active Days</div>
            </div>
            <div class="analytics-card">
                <div class="analytics-value" id="currentStreak">0</div>
                <div class="analytics-label">Current Streak</div>
            </div>
            <div class="analytics-card">
                <div class="analytics-value" id="longestStreak">0</div>
                <div class="analytics-label">Longest Streak</div>
            </div>
            <div class="analytics-card">
                <div class="analytics-value" id="thisMonth">0</div>
                <div class="analytics-label">This Month</div>
            </div>
        </div>

        <div class="calendar-container">
            <div class="calendar-header">
                <h2 id="calendarTitle">2025 Activity Overview</h2>
                <div class="stats">
                    <div class="stat-item">
                        <span id="totalContributions">0</span> contributions in the last year
                    </div>
                </div>
            </div>
            
            <div class="calendar">
                <div class="calendar-grid">
                    <div class="month-labels" id="monthLabels"></div>
                    <div class="weekday-labels">
                        <div>Mon</div>
                        <div></div>
                        <div>Wed</div>
                        <div></div>
                        <div>Fri</div>
                        <div></div>
                        <div>Sun</div>
                    </div>
                    <div class="days-grid" id="daysGrid"></div>
                </div>
            </div>
            
            <div class="legend">
                <span>Less</span>
                <div class="legend-item" style="background-color: #161b22;"></div>
                <div class="legend-item" id="legend1"></div>
                <div class="legend-item" id="legend2"></div>
                <div class="legend-item" id="legend3"></div>
                <div class="legend-item" id="legend4"></div>
                <span>More</span>
            </div>
        </div>

        <div class="export-section">
            <h3 style="margin-bottom: 15px; color: #f0f6fc;">Export & Import</h3>
            <div class="export-buttons">
                <button onclick="exportData()">Export JSON</button>
                <button onclick="exportCSV()">Export CSV</button>
                <button class="secondary-btn" onclick="document.getElementById('importFile').click()">Import Data</button>
                <input type="file" id="importFile" accept=".json,.csv" style="display: none;" onchange="importData(event)">
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // Data storage and management
        let habitData = JSON.parse(localStorage.getItem('habitTracker') || '{}');
        let currentTheme = localStorage.getItem('habitTheme') || 'github';
        
        // Color themes
        const themes = {
            github: ['#161b22', '#0e4429', '#006d32', '#26a641', '#39d353'],
            ocean: ['#0d1117', '#0969da', '#1f6feb', '#58a6ff', '#79c0ff'],
            forest: ['#161b22', '#1a5d1a', '#2b8f2b', '#3fb950', '#56d364'],
            sunset: ['#161b22', '#7c2d12', '#ea580c', '#fb923c', '#fbbf24'],
            purple: ['#161b22', '#581c87', '#7c3aed', '#a855f7', '#c084fc'],
            fire: ['#161b22', '#991b1b', '#dc2626', '#f87171', '#fca5a5']
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setToday();
            generateCalendar();
            updateAnalytics();
            setTheme(currentTheme);
            updateYearProgress();
            
            // Handle habit selection
            document.getElementById('habitSelect').addEventListener('change', function() {
                const customInput = document.getElementById('customHabit');
                if (this.value === 'custom') {
                    customInput.style.display = 'block';
                    customInput.focus();
                } else {
                    customInput.style.display = 'none';
                }
            });
        });

        function setToday() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateInput').value = today;
        }

        function updateYearProgress() {
            const now = new Date();
            const start = new Date(now.getFullYear(), 0, 1);
            const end = new Date(now.getFullYear() + 1, 0, 1);
            const progress = (now - start) / (end - start) * 100;
            document.getElementById('yearProgress').style.width = progress + '%';
        }

        function logToday() {
            const habitSelect = document.getElementById('habitSelect');
            const customHabit = document.getElementById('customHabit');
            
            let habitName = habitSelect.value;
            if (habitName === 'custom') {
                habitName = customHabit.value.trim();
                if (!habitName) {
                    alert('Please enter a custom habit name');
                    return;
                }
            }
            
            const today = new Date().toISOString().split('T')[0];
            const key = `${today}-${habitName}`;
            
            habitData[key] = (habitData[key] || 0) + 1;
            saveData();
            generateCalendar();
            updateAnalytics();
            
            // Visual feedback
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'âœ“ Logged!';
            button.style.background = 'linear-gradient(135deg, #238636, #2ea043)';
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '';
            }, 1500);
        }

        function logHabit() {
            const date = document.getElementById('dateInput').value;
            const value = parseInt(document.getElementById('valueInput').value);
            const habit = document.getElementById('habitInput').value.trim();

            if (!date || !habit) {
                alert('Please fill in all fields');
                return;
            }

            const key = `${date}-${habit}`;
            habitData[key] = value;
            
            saveData();
            generateCalendar();
            updateAnalytics();
            
            // Clear inputs
            document.getElementById('habitInput').value = '';
            document.getElementById('valueInput').value = '1';
        }

        function saveData() {
            localStorage.setItem('habitTracker', JSON.stringify(habitData));
        }

        function generateCalendar() {
            const daysGrid = document.getElementById('daysGrid');
            const monthLabels = document.getElementById('monthLabels');
            
            daysGrid.innerHTML = '';
            monthLabels.innerHTML = '';
            
            const today = new Date();
            const startDate = new Date(today);
            startDate.setDate(today.getDate() - 364); // Last 365 days
            
            // Generate month labels
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                           'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            let currentMonth = -1;
            
            for (let i = 0; i < 53; i++) {
                const weekStart = new Date(startDate);
                weekStart.setDate(startDate.getDate() + (i * 7));
                const month = weekStart.getMonth();
                
                if (month !== currentMonth) {
                    currentMonth = month;
                    const label = document.createElement('div');
                    label.textContent = months[month];
                    monthLabels.appendChild(label);
                } else {
                    monthLabels.appendChild(document.createElement('div'));
                }
            }
            
            // Generate days
            for (let week = 0; week < 53; week++) {
                for (let day = 0; day < 7; day++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(startDate.getDate() + (week * 7) + day);
                    
                    if (currentDate > today) break;
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = 'day';
                    dayElement.style.gridColumn = week + 1;
                    dayElement.style.gridRow = day + 1;
                    
                    const dateStr = currentDate.toISOString().split('T')[0];
                    const dayData = getDayData(dateStr);
                    const intensity = getIntensity(dayData.total);
                    
                    dayElement.style.backgroundColor = themes[currentTheme][intensity];
                    dayElement.dataset.date = dateStr;
                    dayElement.dataset.value = dayData.total;
                    dayElement.dataset.habits = dayData.habits.join(', ') || 'No activity';
                    
                    // Add streak indicator
                    if (isPartOfStreak(dateStr)) {
                        dayElement.classList.add('streak');
                        const indicator = document.createElement('div');
                        indicator.className = 'streak-indicator';
                        dayElement.appendChild(indicator);
                    }
                    
                    dayElement.addEventListener('mouseenter', showTooltip);
                    dayElement.addEventListener('mouseleave', hideTooltip);
                    dayElement.addEventListener('click', () => quickEdit(dateStr));
                    
                    daysGrid.appendChild(dayElement);
                }
            }
            
            updateLegend();
        }

        function getDayData(date) {
            const habits = [];
            let total = 0;
            
            Object.keys(habitData).forEach(key => {
                if (key.startsWith(date + '-')) {
                    const habitName = key.split('-').slice(1).join('-');
                    habits.push(habitName);
                    total += habitData[key];
                }
            });
            
            return { total, habits };
        }

        function getIntensity(value) {
            if (value === 0) return 0;
            if (value <= 2) return 1;
            if (value <= 5) return 2;
            if (value <= 8) return 3;
            return 4;
        }

        function isPartOfStreak(date) {
            const currentDate = new Date(date);
            let streak = 0;
            
            // Check backwards for consecutive days
            for (let i = 0; i < 7; i++) {
                const checkDate = new Date(currentDate);
                checkDate.setDate(currentDate.getDate() - i);
                const checkDateStr = checkDate.toISOString().split('T')[0];
                const dayData = getDayData(checkDateStr);
                
                if (dayData.total > 0) {
                    streak++;
                } else {
                    break;
                }
            }
            
            return streak >= 3; // Show streak indicator for 3+ consecutive days
        }

        function updateLegend() {
            const colors = themes[currentTheme];
            document.getElementById('legend1').style.backgroundColor = colors[1];
            document.getElementById('legend2').style.backgroundColor = colors[2];
            document.getElementById('legend3').style.backgroundColor = colors[3];
            document.getElementById('legend4').style.backgroundColor = colors[4];
        }

        function setTheme(themeName) {
            currentTheme = themeName;
            localStorage.setItem('habitTheme', themeName);
            
            // Update theme button states
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.theme === themeName) {
                    btn.classList.add('active');
                }
            });
            
            generateCalendar();
        }

        function updateAnalytics() {
            const totalDays = new Set();
            let totalContributions = 0;
            const today = new Date();
            const thisMonth = today.getMonth();
            const thisYear = today.getFullYear();
            let thisMonthCount = 0;
            
            Object.keys(habitData).forEach(key => {
                const date = key.split('-')[0];
                const value = habitData[key];
                totalDays.add(date);
                totalContributions += value;
                
                const entryDate = new Date(date);
                if (entryDate.getMonth() === thisMonth && entryDate.getFullYear() === thisYear) {
                    thisMonthCount += value;
                }
            });
            
            const streaks = calculateStreaks();
            
            document.getElementById('totalDays').textContent = totalDays.size;
            document.getElementById('currentStreak').textContent = streaks.current;
            document.getElementById('longestStreak').textContent = streaks.longest;
            document.getElementById('thisMonth').textContent = thisMonthCount;
            document.getElementById('totalContributions').textContent = totalContributions;
        }

        function calculateStreaks() {
            const dates = [...new Set(Object.keys(habitData).map(key => key.split('-')[0]))]
                .sort()
                .reverse();
            
            let currentStreak = 0;
            let longestStreak = 0;
            let tempStreak = 0;
            
            const today = new Date();
            let checkDate = new Date(today);
            
            // Calculate current streak
            while (true) {
                const dateStr = checkDate.toISOString().split('T')[0];
                const dayData = getDayData(dateStr);
                
                if (dayData.total > 0) {
                    currentStreak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }
            
            // Calculate longest streak
            for (let i = 0; i < dates.length; i++) {
                const currentDate = new Date(dates[i]);
                const nextDate = i < dates.length - 1 ? new Date(dates[i + 1]) : null;
                
                tempStreak++;
                
                if (!nextDate || (currentDate - nextDate) / (1000 * 60 * 60 * 24) > 1) {
                    longestStreak = Math.max(longestStreak, tempStreak);
                    tempStreak = 0;
                }
            }
            
            return { current: currentStreak, longest: longestStreak };
        }

        function showTooltip(e) {
            const tooltip = document.getElementById('tooltip');
            const date = e.target.dataset.date;
            const value = e.target.dataset.value;
            const habits = e.target.dataset.habits;
            
            const formattedDate = new Date(date).toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
            
            tooltip.innerHTML = `
                <div><strong>${formattedDate}</strong></div>
                <div>${value} contribution${value !== '1' ? 's' : ''}</div>
                <div style="color: #8b949e; margin-top: 4px;">${habits}</div>
            `;
            
            tooltip.style.display = 'block';
            tooltip.style.left = e.pageX + 10 + 'px';
            tooltip.style.top = e.pageY - 10 + 'px';
        }

        function hideTooltip() {
            document.getElementById('tooltip').style.display = 'none';
        }

        function quickEdit(date) {
            const value = prompt(`Edit contributions for ${date}:\nEnter new value (0-10):`);
            if (value !== null) {
                const numValue = parseInt(value);
                if (numValue >= 0 && numValue <= 10) {
                    // For simplicity, we'll use a default habit name for quick edits
                    const key = `${date}-quick-edit`;
                    if (numValue === 0) {
                        delete habitData[key];
                    } else {
                        habitData[key] = numValue;
                    }
                    saveData();
                    generateCalendar();
                    updateAnalytics();
                }
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(habitData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `habit-tracker-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function exportCSV() {
            let csv = 'Date,Habit,Value\n';
            
            Object.keys(habitData).forEach(key => {
                const [date, ...habitParts] = key.split('-');
                const habit = habitParts.join('-');
                const value = habitData[key];
                csv += `${date},"${habit}",${value}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `habit-tracker-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let importedData = {};
                    
                    if (file.name.endsWith('.json')) {
                        importedData = JSON.parse(e.target.result);
                    } else if (file.name.endsWith('.csv')) {
                        const lines = e.target.result.split('\n');
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (!line) continue;
                            
                            const matches = line.match(/^([^,]+),"([^"]+)",(\d+)$/);
                            if (matches) {
                                const [, date, habit, value] = matches;
                                const key = `${date}-${habit}`;
                                importedData[key] = parseInt(value);
                            }
                        }
                    }
                    
                    if (confirm('This will merge with existing data. Continue?')) {
                        habitData = { ...habitData, ...importedData };
                        saveData();
                        generateCalendar();
                        updateAnalytics();
                        alert('Data imported successfully!');
                    }
                } catch (error) {
                    alert('Error importing data: ' + error.message);
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // Reset file input
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                if (confirm('Really sure? This will delete all your habit tracking data permanently.')) {
                    habitData = {};
                    saveData();
                    generateCalendar();
                    updateAnalytics();
                    alert('All data cleared successfully.');
                }
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'e':
                        e.preventDefault();
                        exportData();
                        break;
                    case 'l':
                        e.preventDefault();
                        document.getElementById('habitInput').focus();
                        break;
                    case 'q':
                        e.preventDefault();
                        logToday();
                        break;
                }
            }
        });

        // Auto-save draft as user types
        document.getElementById('habitInput').addEventListener('input', function() {
            localStorage.setItem('habitDraft', this.value);
        });

        // Restore draft on page load
        window.addEventListener('load', function() {
            const draft = localStorage.getItem('habitDraft');
            if (draft) {
                document.getElementById('habitInput').value = draft;
            }
        });

        // Performance optimization: debounced calendar regeneration
        let regenerateTimeout;
        function debouncedRegenerate() {
            clearTimeout(regenerateTimeout);
            regenerateTimeout = setTimeout(() => {
                generateCalendar();
                updateAnalytics();
            }, 300);
        }

        // Add visual feedback for interactions
        function addRippleEffect(element, e) {
            const ripple = document.createElement('span');
            const rect = element.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            
            ripple.style.cssText = `
                position: absolute;
                width: ${size}px;
                height: ${size}px;
                left: ${x}px;
                top: ${y}px;
                background: rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                transform: scale(0);
                animation: ripple 0.6s ease-out;
                pointer-events: none;
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes ripple {
                    to {
                        transform: scale(4);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
            
            element.style.position = 'relative';
            element.style.overflow = 'hidden';
            element.appendChild(ripple);
            
            setTimeout(() => {
                ripple.remove();
            }, 600);
        }

        // Add ripple effect to buttons
        document.addEventListener('click', function(e) {
            if (e.target.tagName === 'BUTTON') {
                addRippleEffect(e.target, e);
            }
        });

        // Data validation and sanitization
        function validateHabitData() {
            let cleaned = 0;
            Object.keys(habitData).forEach(key => {
                const value = habitData[key];
                if (typeof value !== 'number' || value < 0 || value > 10) {
                    delete habitData[key];
                    cleaned++;
                }
            });
            
            if (cleaned > 0) {
                console.log(`Cleaned ${cleaned} invalid entries`);
                saveData();
            }
        }

        // Initialize data validation
        validateHabitData();

        // Add some sample data for demonstration (only if no data exists)
        if (Object.keys(habitData).length === 0) {
            const today = new Date();
            const sampleHabits = ['exercise', 'reading', 'meditation', 'coding'];
            
            for (let i = 0; i < 60; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                // Randomly add some habits with varying intensity
                sampleHabits.forEach(habit => {
                    if (Math.random() > 0.3) { // 70% chance of having the habit
                        const value = Math.floor(Math.random() * 5) + 1;
                        habitData[`${dateStr}-${habit}`] = value;
                    }
                });
            }
            
            saveData();
        }
    </script>
</body>
</html>